\begin{savequote}[45mm]
\ascii{I'm not a great programmer; I'm just a good programmer with great habits.}
\qauthor{\ascii{- Kent Beck}}
\end{savequote}

\chapter{初识Magellan} 
\label{ch:introduction}

\section{简介}

\begin{content}

\ascii{Magellan}是一个简单的、可扩展的、且用户友好的\ascii{xUnit}测试框架。\ascii{Magellan}设计灵感来自于\ascii{Java}社区著名的测试框架：\ascii{JUnit}。

\ascii{Magellan}采用\ascii{C++11}的语言特性，使得\ascii{xUnit}的设计和实现更加简单和自然；整体框架设计也更加具有可扩展性；最重要的是，\ascii{Magellan}使用例设计更加具有面向对象的特性，用户接口的\ascii{DSL}也更加地友好和统一。

\end{content}

\section{安装}

\begin{content}

\subsection{构建系统}

为了简化\ascii{Magellan}的依赖管理和构建过程，\ascii{Magellan}采用\ascii{CMake}和\ascii{Rake}的构建系统。为此必须先安装{CMake}和\ascii{Ruby}，并确保\ascii{Rake}可用。

\subsubsection{安装CMake}

CMake的下载地址是：\href{http://www.cmake.org}{http://www.cmake.org}。以\ascii{Ubuntu}为例，使用\ascii{apt-get}安装\ascii{CMake}。

\begin{leftbar}
\begin{ruby}[caption={安装RVM}]
$ sudo apt-get install cmake
\end{ruby}
\end{leftbar}

\subsubsection{安装Ruby}

为了方便管理\ascii{Ruby}的多个版本，推荐使用\ascii{RVM}安装\ascii{Ruby}。

\begin{leftbar}
\begin{ruby}[caption={安装RVM}]
$ curl -L get.rvm.io | bash -s stable
$ source ~/.rvm/scripts/rvm
$ source ~/.bashrc
$ source ~/.bash_profile
\end{ruby}
\end{leftbar}

然后使用\ascii{RVM}安装特定版本的\ascii{Ruby}，以安装\ascii{Ruby-2.1.5}为例。

\begin{leftbar}
\begin{ruby}[caption={安装Ruby}]
$ rvm install 2.1.5
$ rvm use 2.1.5 --default
\end{ruby}
\end{leftbar}

\subsubsection{安装Magellan}

最后使用\ascii{Git}从\ascii{Gitlab}克隆一份\ascii{MDK}实现，按照指令完成\ascii{Magellan}的安装： 

\begin{leftbar}
\begin{ruby}[caption={安装Magellan}]
$ git clone https://gitlab.com/horance/mdk.git
$ cd mdk
$ rake
\end{ruby}
\end{leftbar}

\end{content}

\section{破冰之旅}

\begin{content}

\subsection{第一个测试用例}

\begin{leftbar}
\begin{c++}[caption={test/robot-cleaner/TestRobotCleaner.cpp}]
#include "magellan/magellan.hpp"
#include "robot-cleaner/RobotCleaner.h"

USING_HAMCREST_NS

FIXTURE(RobotCleanerTest)
{
    RobotCleaner robot;

    void WHEN_I_send_instruction(Instruction* instruction)
    {
        robot.exec(instruction);
    }

    void THEN_the_robot_cleaner_should_be_in(const Position& position)
    {
        ASSERT_THAT(robot.getPosition(), is(position));
    }

    TEST("at the beginning, the robot should be in at the initial position")
    {
        ASSERT_THAT(robot.getPosition(), is(Position(0, 0, NORTH)));
    }

    TEST("left instruction: 1-times")
    {
        WHEN_I_send_instruction(left());
        THEN_the_robot_cleaner_should_be_in(Position(0, 0, WEST));
    }

    TEST("left instruction: 2-times")
    {
        WHEN_I_send_instruction(repeat(left(), 2));
        THEN_the_robot_cleaner_should_be_in(Position(0, 0, SOUTH));
    }

    TEST("left instruction: 3-times")
    {
        WHEN_I_send_instruction(repeat(left(), 3));
        THEN_the_robot_cleaner_should_be_in(Position(0, 0, EAST));
    }

    TEST("left instruction: 4-times")
    {
        WHEN_I_send_instruction(repeat(left(), 4));
        THEN_the_robot_cleaner_should_be_in(Position(0, 0, NORTH));
    }
};
\end{c++}
\end{leftbar}

\subsection{Main函数}

\begin{leftbar}
\begin{c++}[caption={test/main.cpp}]
#include "magellan/magellan.hpp"

int main(int argc, char** argv)
{
    return magellan::run_all_tests(argc, argv);
}
\end{c++}
\end{leftbar}

\subsection{运行用例}

\begin{leftbar}
\begin{ruby}[caption={运行结果}]
[==========] Running 5 test cases.
[----------] 5 tests from All Tests
[----------] 5 tests from RobotCleanerTest
[ RUN      ] RobotCleanerTest::at the beginning, the robot should be in at the initial position
[       OK ] RobotCleanerTest::at the beginning, the robot should be in at the initial position(60 us)
[ RUN      ] RobotCleanerTest::left instruction: 1-times
[       OK ] RobotCleanerTest::left instruction: 1-times(60 us)
[ RUN      ] RobotCleanerTest::left instruction: 2-times
[       OK ] RobotCleanerTest::left instruction: 2-times(60 us)
[ RUN      ] RobotCleanerTest::left instruction: 3-times
[       OK ] RobotCleanerTest::left instruction: 3-times(60 us)
[ RUN      ] RobotCleanerTest::left instruction: 4-times
[       OK ] RobotCleanerTest::left instruction: 4-times(60 us)
[----------] 5 tests from RobotCleanerTest

[----------] 5 tests from All Tests

[==========] 5 test cases ran.
[  TOTAL   ] PASS: 5  FAILURE: 0  ERROR: 0  TIME: 300 us
\end{ruby}
\end{leftbar}

\end{content}
